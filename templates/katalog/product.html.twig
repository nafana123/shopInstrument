{% include 'header/header.html.twig' %}

<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{{ asset('style/katalog/product.css') }}">

    <title>{% block title %}onlineshop{% endblock %}</title>
    {% block stylesheets %}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    {% endblock %}
</head>
<body>
<div class="container">
    <nav style="--bs-breadcrumb-divider: '->';" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ path('mainpage') }}" style="text-decoration: none; color: black">Главная</a></li>
            <li class="breadcrumb-item active" aria-current="page">Ассортимент</li>
        </ol>
    </nav>
    <div class="row justify-content-start">
        {% for product in products %}
            <article class="col-sm-6 col-md-4 col-lg-3">
                <div class="card">
                    <div class="card__top">
                        <a href="{{ path('info_product', {'typeId': product.types, 'name': product.name, 'id': product.id}) }}" class="card__image">
                            <img src="{{ asset('picture/katalog/' ~ product.img) }}" class="card-img-top" alt="{{ product.name }}">
                        </a>
                        <div class="card__label">-10%</div>
                    </div>
                    <div class="card__bottom">
                        <div class="card__prices">
                            <div class="card__price card__price--discount">{{ product.amount }}</div>
                            <div class="card__price card__price--common">150 000</div>
                        </div>
                        <a href="{{ path('info_product', {'typeId': product.types, 'name': product.name, 'id': product.id}) }}" class="card__title">
                            {{ product.name }}
                        </a>
                        <button type="button" class="btn btn-outline-success btn-add-to-cart" data-product-id="{{ product.id }}" onclick="updateCartItemCount()">В корзину</button>
                    </div>
                </div>
            </article>
        {% endfor %}
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var addToCartButtons = document.querySelectorAll('.btn-add-to-cart');

        addToCartButtons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault();

                var productId = button.dataset.productId;
                var quantity = 1;
                var cartItem = productId + ':' + quantity;
                var existingCartItems = document.cookie.replace(/(?:(?:^|.*;\s*)cart\s*=\s*([^;]*).*$)|^.*$/, "$1");
                var updatedCart = '';

                if (existingCartItems) {
                    var items = existingCartItems.split(',');
                    var found = false;

                    for (var i = 0; i < items.length; i++) {
                        var parts = items[i].split(':');
                        if (parts[0] === productId) {
                            parts[1] = parseInt(parts[1]) + quantity;
                            found = true;
                        }
                        updatedCart += (i > 0 ? ',' : '') + parts.join(':');
                    }

                    if (!found) {
                        updatedCart += ',' + cartItem;
                    }
                } else {
                    updatedCart = cartItem;
                }

                document.cookie = 'cart=' + updatedCart + '; path=/';
                updateCartItemCount();
            });
        });
    });

    updateCartItemCount();
</script>


</body>
</html>



{% include 'footer/footer.html.twig' %}
